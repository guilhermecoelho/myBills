(function(){angular.module("billApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,t){e.when("/",{templateUrl:"/views/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/bills/:billId",{templateUrl:"/views/billDetails/billDetails.view.html",controller:"billDetailsCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/views/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/views/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/confirmEmail/:token",{templateUrl:"/views/auth/confirmEmail/confirmEmail.view.html",controller:"confirmEmailCtrl",controllerAs:"vm"}).when("/notValidated/:email",{templateUrl:"/views/auth/notValidated/notValidated.view.html",controller:"notValidatedCtrl",controllerAs:"vm"}).when("/account/:id",{templateUrl:"/views/auth/account/account.view.html",controller:"accountCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode({enable:true,requireBase:false})}angular.module("billApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("billApp").controller("homeCtrl",e);e.$inject=["billData","$modal","$log","authentication","$location"];function e(e,t,n,r,a){var l=this;l.isLoggedIn=r.isLoggedIn();if(l.isLoggedIn){l.pageHeader={title:"my Bills"};l.message="my bills";o();l.popupEditForm=function(e){l.data=e;var n=l.data.id==""?false:true;var r=t.open({templateUrl:"views/billDetailsModal/billDetailsModal.view.html",controller:"billDetailsModalCtrl as vm",resolve:{billDataForm:function(){o();return{id:l.data._id,name:l.data.name,payday:l.data.payday,autopay:l.data.autopay,payed:l.data.payday}}}});r.result.then(function(e){if(!n){l.data.bills.push(e)}else{o()}})};l.popupNewForm=function(){var e=t.open({templateUrl:"views/billDetailsModal/billDetailsModal.view.html",controller:"billDetailsModalCtrl as vm",resolve:{billDataForm:function(){o()}}});e.result.then(function(e){l.data.bills.push(e)})};l.showError=function(e){$scope.$apply(function(){l.message=e.message})};l.popupDelete=function(e){l.data=e;var n=t.open({templateUrl:"views/modals/confirm.view.html",controller:"confirmCtrl as vm",resolve:{billDataForm:function(){o();return{id:l.data._id}}}});n.result.then(function(e){o()})};l.showError=function(e){$scope.$apply(function(){l.message=e.message})};function o(){e.billList().success(function(e){l.message=e.length>0?"":"No bills found";l.data={bills:e}}).error(function(e){l.message="Sorry, something's gone wrong"})}l.changePay=function(t){e.billUpdate(t._id,{name:t.name,payday:t.payday,autopay:t.autopay,payed:!t.payed}).success(function(e){o()}).error(function(e){l.formError="Error on update"});return false}}else{a.path("/login")}}})();(function(){angular.module("billApp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About bills"};e.main={content:"testing another page \n and again"}}})();(function(){angular.module("billApp").controller("billDetailsCtrl",e);e.$inject=["$routeParams","$modal","billData"];function e(e,t,n){var r=this;r.billId=e.billId;n.billById(r.billId).success(function(e){r.data={bill:e};r.pageHeader={title:r.data.bill.name}}).error(function(e){console.log(e)});r.popupEditForm=function(){var e=t.open({templateUrl:"views/billDetailsModal/billDetailsModal.view.html",controller:"billDetailsModalCtrl as vm",resolve:function(){return{billId:r.billId,billName:r.data.bill.name,billPayday:r.data.bill.payday}}})}}})();(function(){angular.module("billApp").controller("billDetailsModalCtrl",e);e.$inject=["$modalInstance","billData","billDataForm","$log","$routeParams"];function e(e,t,n,r,a){var l=this;l.formData=n;l.onSubmit=function(){l.formError="";var e=l.formData.id==null?false:true;if(!l.formData.name||!l.formData.payday){l.formError="All fields required, please try again";return false}else{l.formData.autopay=l.formData.autopay==null?false:true;if(e){l.billUpdate(l.formData.id,l.formData)}else{l.billCreate(l.formData)}}};l.billUpdate=function(e,n){t.billUpdate(e,{name:n.name,payday:n.payday,autopay:n.autopay}).success(function(e){l.modal.close(e)}).error(function(e){l.formError="Error on update"});return false};l.billCreate=function(e){t.billCreate({name:e.name,payday:e.payday,autopay:e.autopay}).success(function(e){l.modal.close(e)}).error(function(e){l.formError="Error on create"});return false};l.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("billApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var n=this;n.pageHeader={title:"Create a new account"};n.credentials={email:"",name:"",password:""};n.returnPage=e.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.email||!n.credentials.name||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doRegister()}};n.doRegister=function(){n.formError="";t.register(n.credentials).error(function(e){n.formError=e.message}).then(function(){e.search("page",null);e.path(n.returnPage)})}}})();(function(){angular.module("billApp").controller("loginCtrl",e);e.$inject=["$location","$modal","authentication"];function e(e,t,n){var r=this;r.pageHeader={title:"Sign in"};r.credentials={email:"",name:"",password:""};r.returnPage=e.search().page||"/";r.onSubmit=function(){r.formError="";if(!r.credentials.email||!r.credentials.password){r.formError="All fields required, please try again";return false}else{r.doLogin()}};r.doLogin=function(){r.formError="";n.login(r.credentials).error(function(e){if(e.message=="User not validated"){console.log(r.credentials.email);r.notValidated=r.credentials.email}r.formError=e.message}).then(function(){e.search("page",null);e.path(r.returnPage)})};r.newTokenValidation=function(e){n.newTokenValidation(e).success(function(e){r.popupConfirmSendEmail(true)}).error(function(e){r.popupConfirmSendEmail(false)})};r.popupConfirmSendEmail=function(e){var n=e==true?"Email send successly":"Erro to send email";var r=t.open({templateUrl:"views/modals/alert/alert.view.html",controller:"alertCtrl as vm",resolve:{data:function(){return{message:n}}}})}}})();(function(){angular.module("billApp").controller("confirmEmailCtrl",e);e.$inject=["$location","$routeParams","authentication"];function e(e,t,n){var r=this;r.token=t.token;n.confirmEmail(r.token).success(function(t){e.search("page",null);e.path("/")}).error(function(e){r.message=e.message})}})();(function(){angular.module("billApp").controller("accountCtrl",e);e.$inject=["$location","authentication","$routeParams"];function e(e,t,n){var r=this;var a=n.id;r.pageHeader={title:"Your account"};r.credentials={id:"",email:"",name:"",password:""};t.account(a).success(function(e){r.credentials={id:e._id,email:e.email,name:e.name,password:"",isUpdate:true}}).error(function(e){console.log(e)});r.returnPage=e.search().page||"/";r.onSubmit=function(){r.formError="";if(!r.credentials.email||!r.credentials.name||!r.credentials.password){r.formError="All fields required, please try again";return false}else{r.Update()}};r.Update=function(){r.formError="";t.updateRegister(r.credentials).error(function(e){r.formError=e.message}).then(function(){e.search("page",null);e.path(r.returnPage)})}}})();(function(){angular.module("billApp").controller("confirmCtrl",e);e.$inject=["$modalInstance","billData","billDataForm","$log"];function e(e,t,n,r){var a=this;a.data=n;a.modal={cancel:function(){e.dismiss("cancel")},"delete":function(e){t.billDelete(e).success(function(e){a.modal.close(e)}).error(function(e){a.formError="Error on delete"});return false}}}})();(function(){angular.module("billApp").controller("alertCtrl",e);e.$inject=["$modalInstance","data"];function e(e,t){var n=this;n.message=t.message;n.modal={close:function(){e.dismiss("cancel")}}}})();(function(){angular.module("billApp").filter("addHtmlLineBreaks",e);function e(){return function(e){return e.replace(/\n/g,"<br />")}}})();(function(){angular.module("billApp").service("billData",e);e.$inject=["$http","authentication"];function e(e,t){var n=function(){return e.get("/api/bills",{headers:{Authorization:"Bearer "+t.getToken()}})};var r=function(n){return e.get("/api/bills/"+n,{headers:{Authorization:"Bearer "+t.getToken()}})};var a=function(n,r){return e.put("/api/bills/"+n,r,{headers:{Authorization:"Bearer "+t.getToken()}})};var l=function(n){return e.post("/api/bills/",n,{headers:{Authorization:"Bearer "+t.getToken()}})};var o=function(n){return e.delete("/api/bills/"+n,{headers:{Authorization:"Bearer "+t.getToken()}})};return{billList:n,billById:r,billUpdate:a,billCreate:l,billDelete:o}}})();(function(){angular.module("billApp").service("authentication",e);e.$inject=["$window","$http"];function e(e,t,n){var r=function(t){e.localStorage["billApp-token"]=t};var a=function(){return e.localStorage["billApp-token"]};var l=function(){var t=a();if(t){var n=JSON.parse(e.atob(t.split(".")[1]));return n.exp>Date.now()/1e3}else{return false}};var o=function(){if(l()){var t=a();var n=JSON.parse(e.atob(t.split(".")[1]));return{name:n.name,id:n._id}}};register=function(e){return t.post("/api/register",e).success(function(e){r(e.token)})};updateRegister=function(e){return t.put("/api/updateRegister",e,{headers:{Authorization:"Bearer "+a()}})};login=function(e){return t.post("/api/login",e).success(function(e){r(e.token)})};confirmEmail=function(e){return t.get("/api/confirmemail/"+e).success(function(e){r(e.token)})};newTokenValidation=function(e){return t.get("/api/newTokenValidation/"+e).success(function(e){})};logout=function(){e.localStorage.removeItem("billApp-token")};account=function(e){return t.get("/api/account/"+e,{headers:{Authorization:"Bearer "+a()}})};return{saveToken:r,getToken:a,register:register,updateRegister:updateRegister,login:login,logout:logout,isLoggedIn:l,currentUser:o,confirmEmail:confirmEmail,newTokenValidation:newTokenValidation,account:account}}})();(function(){angular.module("billApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("billApp").directive("navegation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navegation/navegation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("billApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var n=this;n.currentPath=e.path();n.isLoggedIn=t.isLoggedIn();n.currentUser=t.currentUser();n.logout=function(){t.logout();e.path("/login")}}})();(function(){angular.module("billApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();