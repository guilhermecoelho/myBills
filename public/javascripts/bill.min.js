(function(){angular.module("billApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,t){e.when("/",{templateUrl:"/views/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/bills/:billId",{templateUrl:"/views/billDetails/billDetails.view.html",controller:"billDetailsCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/views/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/views/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/confirmEmail/:token",{templateUrl:"/views/auth/confirmEmail/confirmEmail.view.html",controller:"confirmEmailCtrl",controllerAs:"vm"}).when("/notValidated/:email",{templateUrl:"/views/auth/notValidated/notValidated.view.html",controller:"notValidatedCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode({enable:true,requireBase:false})}angular.module("billApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("billApp").controller("homeCtrl",e);e.$inject=["billData","$modal","$log","authentication","$location"];function e(e,t,l,n,a){var r=this;r.isLoggedIn=n.isLoggedIn();if(r.isLoggedIn){r.pageHeader={title:"my Bills"};r.message="my bills";o();r.popupEditForm=function(e){r.data=e;var l=r.data.id==""?false:true;var n=t.open({templateUrl:"views/billDetailsModal/billDetailsModal.view.html",controller:"billDetailsModalCtrl as vm",resolve:{billDataForm:function(){o();return{id:r.data._id,name:r.data.name,payday:r.data.payday,autopay:r.data.autopay,payed:r.data.payday}}}});n.result.then(function(e){if(!l){r.data.bills.push(e)}else{o()}})};r.popupNewForm=function(){var e=t.open({templateUrl:"views/billDetailsModal/billDetailsModal.view.html",controller:"billDetailsModalCtrl as vm",resolve:{billDataForm:function(){o()}}});e.result.then(function(e){r.data.bills.push(e)})};r.showError=function(e){$scope.$apply(function(){r.message=e.message})};r.popupDelete=function(e){r.data=e;var l=t.open({templateUrl:"views/modals/confirm.view.html",controller:"confirmCtrl as vm",resolve:{billDataForm:function(){o();return{id:r.data._id}}}});l.result.then(function(e){o()})};r.showError=function(e){$scope.$apply(function(){r.message=e.message})};function o(){e.billList().success(function(e){r.message=e.length>0?"":"No bills found";r.data={bills:e}}).error(function(e){r.message="Sorry, something's gone wrong"})}r.changePay=function(t){e.billUpdate(t._id,{name:t.name,payday:t.payday,autopay:t.autopay,payed:!t.payed}).success(function(e){o()}).error(function(e){r.formError="Error on update"});return false}}else{a.path("/login")}}})();(function(){angular.module("billApp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About bills"};e.main={content:"testing another page \n and again"}}})();(function(){angular.module("billApp").controller("billDetailsCtrl",e);e.$inject=["$routeParams","$modal","billData"];function e(e,t,l){var n=this;n.billId=e.billId;l.billById(n.billId).success(function(e){n.data={bill:e};n.pageHeader={title:n.data.bill.name}}).error(function(e){console.log(e)});n.popupEditForm=function(){var e=t.open({templateUrl:"views/billDetailsModal/billDetailsModal.view.html",controller:"billDetailsModalCtrl as vm",resolve:function(){return{billId:n.billId,billName:n.data.bill.name,billPayday:n.data.bill.payday}}})}}})();(function(){angular.module("billApp").controller("billDetailsModalCtrl",e);e.$inject=["$modalInstance","billData","billDataForm","$log","$routeParams"];function e(e,t,l,n,a){var r=this;r.formData=l;r.onSubmit=function(){r.formError="";var e=r.formData.id==null?false:true;if(!r.formData.name||!r.formData.payday){r.formError="All fields required, please try again";return false}else{r.formData.autopay=r.formData.autopay==null?false:true;if(e){r.billUpdate(r.formData.id,r.formData)}else{r.billCreate(r.formData)}}};r.billUpdate=function(e,l){t.billUpdate(e,{name:l.name,payday:l.payday,autopay:l.autopay}).success(function(e){r.modal.close(e)}).error(function(e){r.formError="Error on update"});return false};r.billCreate=function(e){t.billCreate({name:e.name,payday:e.payday,autopay:e.autopay}).success(function(e){r.modal.close(e)}).error(function(e){r.formError="Error on create"});return false};r.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("billApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var l=this;l.pageHeader={title:"Create a new account"};l.credentials={email:"",name:"",password:""};l.returnPage=e.search().page||"/";l.onSubmit=function(){l.formError="";if(!l.credentials.email||!l.credentials.name||!l.credentials.password){l.formError="All fields required, please try again";return false}else{l.doRegister()}};l.doRegister=function(){l.formError="";t.register(l.credentials).error(function(e){l.formError=e.message}).then(function(){e.search("page",null);e.path(l.returnPage)})}}})();(function(){angular.module("billApp").controller("loginCtrl",e);e.$inject=["$location","$modal","authentication"];function e(e,t,l){var n=this;n.pageHeader={title:"Sign in"};n.credentials={email:"",name:"",password:""};n.returnPage=e.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doLogin()}};n.doLogin=function(){n.formError="";l.login(n.credentials).error(function(e){if(e.message=="User not validated"){console.log(n.credentials.email);n.notValidated=n.credentials.email}n.formError=e.message}).then(function(){e.search("page",null);e.path(n.returnPage)})};n.newTokenValidation=function(e){l.newTokenValidation(e).success(function(e){n.popupConfirmSendEmail(true)}).error(function(e){n.popupConfirmSendEmail(false)})};n.popupConfirmSendEmail=function(e){var l=e==true?"Email send successly":"Erro to send email";var n=t.open({templateUrl:"views/modals/alert/alert.view.html",controller:"alertCtrl as vm",resolve:{data:function(){return{message:l}}}})}}})();(function(){angular.module("billApp").controller("confirmEmailCtrl",e);e.$inject=["$location","$routeParams","authentication"];function e(e,t,l){var n=this;n.token=t.token;l.confirmEmail(n.token).success(function(t){e.search("page",null);e.path("/")}).error(function(e){n.message=e.message})}})();(function(){angular.module("billApp").controller("confirmCtrl",e);e.$inject=["$modalInstance","billData","billDataForm","$log"];function e(e,t,l,n){var a=this;a.data=l;a.modal={cancel:function(){e.dismiss("cancel")},"delete":function(e){t.billDelete(e).success(function(e){a.modal.close(e)}).error(function(e){a.formError="Error on delete"});return false}}}})();(function(){angular.module("billApp").controller("alertCtrl",e);e.$inject=["$modalInstance","data"];function e(e,t){var l=this;l.message=t.message;l.modal={close:function(){e.dismiss("cancel")}}}})();(function(){angular.module("billApp").filter("addHtmlLineBreaks",e);function e(){return function(e){return e.replace(/\n/g,"<br />")}}})();(function(){angular.module("billApp").service("billData",e);e.$inject=["$http","authentication"];function e(e,t){var l=function(){return e.get("/api/bills",{headers:{Authorization:"Bearer "+t.getToken()}})};var n=function(l){return e.get("/api/bills/"+l,{headers:{Authorization:"Bearer "+t.getToken()}})};var a=function(l,n){return e.put("/api/bills/"+l,n,{headers:{Authorization:"Bearer "+t.getToken()}})};var r=function(l){return e.post("/api/bills/",l,{headers:{Authorization:"Bearer "+t.getToken()}})};var o=function(l){return e.delete("/api/bills/"+l,{headers:{Authorization:"Bearer "+t.getToken()}})};return{billList:l,billById:n,billUpdate:a,billCreate:r,billDelete:o}}})();(function(){angular.module("billApp").service("authentication",e);e.$inject=["$window","$http"];function e(e,t,l){var n=function(t){e.localStorage["billApp-token"]=t};var a=function(){return e.localStorage["billApp-token"]};var r=function(){var t=a();if(t){var l=JSON.parse(e.atob(t.split(".")[1]));return l.exp>Date.now()/1e3}else{return false}};var o=function(){if(r()){var t=a();var l=JSON.parse(e.atob(t.split(".")[1]));return{name:l.name}}};register=function(e){return t.post("/api/register",e).success(function(e){n(e.token)})};login=function(e){return t.post("/api/login",e).success(function(e){n(e.token)})};confirmEmail=function(e){return t.get("/api/confirmemail/"+e).success(function(e){n(e.token)})};newTokenValidation=function(e){return t.get("/api/newTokenValidation/"+e).success(function(e){})};logout=function(){e.localStorage.removeItem("billApp-token")};return{saveToken:n,getToken:a,register:register,login:login,logout:logout,isLoggedIn:r,currentUser:o,confirmEmail:confirmEmail,newTokenValidation:newTokenValidation}}})();(function(){angular.module("billApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("billApp").directive("navegation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navegation/navegation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("billApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var l=this;l.currentPath=e.path();l.isLoggedIn=t.isLoggedIn();l.currentUser=t.currentUser();l.logout=function(){t.logout();e.path("/login")}}})();(function(){angular.module("billApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();